
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>BrainSimulator’s Overview &#8212; brainSimulator 0.5.1 documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.5.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Training brainSimulator’s objects" href="training.html" />
    <link rel="prev" title="Welcome to brainSimulator’s documentation!" href="index.html" /> 
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="training.html" title="Training brainSimulator’s objects"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Welcome to brainSimulator’s documentation!"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">brainSimulator 0.5.1 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="brainsimulator-s-overview">
<h1>BrainSimulator’s Overview<a class="headerlink" href="#brainsimulator-s-overview" title="Permalink to this headline">¶</a></h1>
<p><cite>brainSimulator</cite> is a brain image synthesis procedure intended to generate a new image set that share characteristics with an original one. The system focuses on nuclear imaging modalities such as PET or SPECT brain images. It analyses the dataset by applying PCA to the original dataset, and then model the distribution of samples in the projected eigenbrain space using a Probability Density Function (PDF) estimator. Once the model has been built, anyone can generate new coordinates on the eigenbrain space belonging to the same class, which can be then projected back to the image space.</p>
<div class="figure align-center" style="width: 70%">
<img alt="Schema of the synthesis methodology." src="_images/schema.png" />
</div>
<div class="section" id="quickstart">
<h2>Quickstart<a class="headerlink" href="#quickstart" title="Permalink to this headline">¶</a></h2>
<div class="section" id="the-stack">
<h3>The “stack”<a class="headerlink" href="#the-stack" title="Permalink to this headline">¶</a></h3>
<p>The first key concept here is a <strong>stack</strong>. A <cite>stack</cite> is a bidimensional <cite>numpy.ndarray</cite> of size <cite>N`x`K</cite>, where <cite>N</cite> is the number of brain images available and <cite>K</cite> is the number of voxels in each image. It is <strong>important</strong> to remark that all images must have been registered to the same brain space (<em>recommendation: use MNI space</em>). Use a similar code to this to generate a stack:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">nibabel</span> <span class="k">as</span> <span class="nn">nib</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">create_stack</span><span class="p">(</span><span class="n">list_images</span><span class="p">):</span>
        <span class="n">i</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_images</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">im</span> <span class="ow">in</span> <span class="n">list_images</span><span class="p">:</span>
                <span class="n">image</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
                <span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_label</span><span class="p">(</span><span class="n">im</span><span class="p">)</span> <span class="c1"># get the image label</span>
                <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">stack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">datos</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                <span class="n">stack</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,:,:]</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">stack</span><span class="p">,</span> <span class="n">labels</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-the-brainsimulator-object">
<h3>Creating the brainSimulator object<a class="headerlink" href="#creating-the-brainsimulator-object" title="Permalink to this headline">¶</a></h3>
<p>With the new version, the whole interface has been switched to an object. This allows to train the model once and then perform as many sample drawings as required. To do so, we simply navigate to the folder where the simulator.py is located (if that folder is added to the path, that is not necessary), and import the module:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">#navigate to the folder where simulator.py is located</span>
<span class="kn">import</span> <span class="nn">brainSimulator</span> <span class="k">as</span> <span class="nn">sim</span>

<span class="n">simulator</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">BrainSimulator</span><span class="p">(</span><span class="n">algorithm</span><span class="o">=</span><span class="s1">&#39;PCA&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;mvnormal&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>There are different PDF modelling methods: <cite>mvnormal</cite>, <cite>gaussian</cite> and <cite>kde</cite>. Other methods based on alpha-stable distribution are planned for the future. The most accurate method is the <cite>mvnormal</cite>, but it requires some further tuning of the parameters. A high number of components may lead to overfitting, producing, when n_comp tends to infinity, always the average image of each class. For its part, the <cite>kde</cite> method is less accurate, but it works essentialy <em>out of the box</em>. Use them at your discrection.</p>
</div>
<div class="section" id="fitting-the-model">
<h3>Fitting the model<a class="headerlink" href="#fitting-the-model" title="Permalink to this headline">¶</a></h3>
<p>Once the object has been created, we use the <cite>stack</cite> and its labels to fit the model:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">simulator</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">stack</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
</pre></div>
</div>
<p>This procedure may take some time, depending on the PDF estimation method.</p>
</div>
<div class="section" id="generating-a-new-dataset">
<h3>Generating a new dataset<a class="headerlink" href="#generating-a-new-dataset" title="Permalink to this headline">¶</a></h3>
<p>Once the fitting procedure has finalised, you can generate a new dataset using the trained object:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">new_stack</span><span class="p">,</span> <span class="n">new_labels</span> <span class="o">=</span> <span class="n">simulator</span><span class="o">.</span><span class="n">generateDataset</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
<p>This will generate 200 new samples for each class in 0, 1 and 2, ready to use in our favourite machine learning algorithm.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">BrainSimulator’s Overview</a><ul>
<li><a class="reference internal" href="#quickstart">Quickstart</a><ul>
<li><a class="reference internal" href="#the-stack">The “stack”</a></li>
<li><a class="reference internal" href="#creating-the-brainsimulator-object">Creating the brainSimulator object</a></li>
<li><a class="reference internal" href="#fitting-the-model">Fitting the model</a></li>
<li><a class="reference internal" href="#generating-a-new-dataset">Generating a new dataset</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Welcome to brainSimulator’s documentation!</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="training.html"
                        title="next chapter">Training brainSimulator’s objects</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="training.html" title="Training brainSimulator’s objects"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Welcome to brainSimulator’s documentation!"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">brainSimulator 0.5.1 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, SiPBA@UGR.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.5.
    </div>
  </body>
</html>